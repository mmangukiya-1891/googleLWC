<html lang="en">

<script src="https://dchomebuyer--devcon.sandbox.my.site.com/dchomebuyer/lightning/lightning.out.js"></script>
<div data-lightning-out="true"></div>
<script>
    const appName = 'c:googlePlaceAura';
    const componentName = 'c:googlePlacesLWC';
    const lightningEndpoint = 'https://dchomebuyer--devcon.sandbox.my.site.com/dchomebuyer';
    const targetElement = document.querySelector("[data-lightning-out]");

    // Function to parse UTM parameters
    function getUTMParams() {
        const urlParams = new URLSearchParams(window.location.search);
        return {
            utm_source: urlParams.get('utm_source') || '',
            utm_medium: urlParams.get('utm_medium') || '',
            utm_campaign: urlParams.get('utm_campaign') || '',
            utm_term: urlParams.get('utm_term') || '',
            utm_content: urlParams.get('utm_content') || '',
            utm_keyword: urlParams.get('utm_keyword') || '',
            utm_matchtype: urlParams.get('utm_matchtype') || ''
        };
    }

    // Capture UTM parameters
    const utmParams = getUTMParams();

    // Pass UTM parameters as attributes to the LWC
    const componentAttributes = {
        utmSource: utmParams.utm_source,
        utmMedium: utmParams.utm_medium,
        utmCampaign: utmParams.utm_campaign,
        utmTerm: utmParams.utm_term,
        utmContent: utmParams.utm_content,
        utmKeyword: utmParams.utm_keyword,
        utmMatchType: utmParams.utm_matchtype
    };

    $Lightning.use(
        appName, // Name of the Lightning Out app
        function () {
            // Callback once framework and app loaded
            $Lightning.createComponent(
                componentName, // Top-level component of your app
                componentAttributes, // Pass extracted UTM parameters
                targetElement,
                function (cmp) {
                    // Callback when component is created and active on the page
                    console.log("Lightning Web Component loaded successfully with UTM parameters.", componentAttributes);
                }
            );
        },
        lightningEndpoint
    );

</script>
</html>
